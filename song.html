<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üéµ Our Songs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; text-align: center; background: #fff0f5; padding:10px; }
  input, textarea { margin:5px 0; padding:10px; border-radius:5px; border:1px solid #d63384; width:90%; max-width:400px; }
  button { margin:5px; padding:10px 15px; background:#25D366; color:white; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
  #results { margin-top:10px; max-height:250px; overflow-y:auto; }
  .song-item { padding:8px; border-bottom:1px solid #d63384; cursor:pointer; background:#ffe6f0; border-radius:5px; }
  .song-item:hover { background:#ffd1e6; }
  .vault-entry { margin-bottom:10px; padding:8px; border-bottom:1px solid #d63384; border-radius:5px; background:#fff0f5; }
  .action-btn { font-size:14px; margin:3px 3px 0 0; padding:5px 10px; border-radius:5px; border:none; cursor:pointer; }
  .delete-btn { background:#d63333; color:white; }
</style>
</head>
<body>

<h1>üéµ Our Songs</h1>

<input type="text" id="songTitle" placeholder="Search or enter song title"><br>
<textarea id="songNote" rows="3" placeholder="Why this song?"></textarea><br>
<button onclick="addSong()">Add Song üíñ</button>
<p id="status"></p>

<h2>Saved Songs üíñ</h2>
<div id="vault">Loading songs...</div>

<div id="results"></div>

<script>
// --- Load Vault ---
function loadVault(){
  const vault = JSON.parse(localStorage.getItem("vault")) || [];
  const vaultDiv = document.getElementById("vault");
  if(vault.length === 0){
    vaultDiv.innerText = "No songs yet üéµ";
    return;
  }
  vaultDiv.innerHTML = "";
  vault.forEach((song,index)=>{
    const div = document.createElement("div");
    div.className = "vault-entry";
    div.innerHTML = `üéµ ${song.title} üíñ<br>Why: ${song.note}<br>
      Link: <a href="${song.link}" target="_blank">${song.link || "N/A"}</a><br>
      <button class="action-btn delete-btn" onclick="deleteSong(${index})">Delete ‚ùå</button>`;
    vaultDiv.appendChild(div);
  });
}

// --- Add Song ---
function addSong(titleInput, linkInput){
  const title = titleInput || document.getElementById("songTitle").value.trim();
  const note = document.getElementById("songNote").value.trim();
  const link = linkInput || "";
  if(!title || !note) return alert("Enter both song title and note üíñ");
  const vault = JSON.parse(localStorage.getItem("vault")) || [];
  vault.push({title,note,link,date:new Date().toLocaleString()});
  localStorage.setItem("vault", JSON.stringify(vault));
  document.getElementById("songTitle").value="";
  document.getElementById("songNote").value="";
  document.getElementById("status").innerText = `Song "${title}" saved! üéµ`;
  loadVault();
}

// --- Delete Song ---
function deleteSong(index){
  const vault = JSON.parse(localStorage.getItem("vault")) || [];
  if(confirm("Delete this song? üíî")){
    vault.splice(index,1);
    localStorage.setItem("vault", JSON.stringify(vault));
    loadVault();
  }
}

// --- iTunes Search ---
const searchBox = document.getElementById("songTitle");
searchBox.addEventListener("input", function(){
  const query = this.value.trim();
  if(query.length<2) return document.getElementById("results").innerHTML="";
  fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=5`)
  .then(res=>res.json())
  .then(data=>{
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML="";
    data.results.forEach(song=>{
      const div = document.createElement("div");
      div.className="song-item";
      div.innerText = `${song.trackName} - ${song.artistName}`;
      div.onclick = ()=>{
        const note = document.getElementById("songNote").value.trim();
        if(!note) return alert("Enter why you chose this song first üíñ");
        addSong(song.trackName,song.trackViewUrl);
        resultsDiv.innerHTML="";
      };
      resultsDiv.appendChild(div);
    });
  });
});

loadVault();
</script>

</body>
</html>
